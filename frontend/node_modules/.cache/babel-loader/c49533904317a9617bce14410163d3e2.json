{"ast":null,"code":"import _regeneratorRuntime from\"/home/youssef/Documents/workSpace/mern_e_commerce/frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/youssef/Documents/workSpace/mern_e_commerce/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/youssef/Documents/workSpace/mern_e_commerce/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect}from'react';import axios from'axios';import{PayPalButton}from'react-paypal-button-v2';import*as A from'../store/constants/orderConstant';import{Image,Button}from'react-bootstrap';import{useDispatch,useSelector}from'react-redux';import{Loader}from'../components/Loader';import{Message}from'../components/Message';import{deliverOrder,getOrderDetails,payOrder}from'../store/actions/orderActions';import{Link}from'react-router-dom';var OrderScreen=function OrderScreen(_ref){var match=_ref.match,history=_ref.history;var orderId=match.params.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var dispatch=useDispatch();var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,loading=orderDetails.loading,error=orderDetails.error;var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success;var orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,successDeliver=orderDeliver.success;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;//Calculate prices\nif(!loading){var addDecimal=function addDecimal(num){return(Math.round(num*100)/100).toFixed(2);};order.itemsPrice=addDecimal(order.orderItems.reduce(function(acc,item){return acc+item.price*item.qty;},0));}useEffect(function(){if(!userInfo){history.push('./login');}var addPaypalScript=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/config/paypal');case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;script=document.createElement('script');script.type='text/javascript';script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 10:case\"end\":return _context.stop();}}},_callee);}));return function addPaypalScript(){return _ref2.apply(this,arguments);};}();if(!order||successPay||successDeliver){dispatch({type:A.ORDER_PAY_RESET});dispatch({type:A.ORDER_DELIVER_RESET});dispatch(getOrderDetails(orderId));}else if(!order.isPaid){if(!window.paypal){addPaypalScript();}else{setSdkReady(true);}}},[dispatch,orderId,successPay,order,successDeliver]);var successPaymentHandler=function successPaymentHandler(paymentResult){console.log('paymentResult',paymentResult);dispatch(payOrder(orderId,paymentResult));};var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order));};return loading?/*#__PURE__*/_jsx(Loader,{}):error?/*#__PURE__*/_jsx(Message,{children:error}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Order \",order._id,\" \"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-8\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"list-group list-group-flush\",children:[/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"p\",{children:[' ',/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),order.user.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),/*#__PURE__*/_jsxs(Link,{to:\"mailto:\".concat(order.user.email),children:[order.user.email,' ']})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address:\"}),order.shippingAddress.address,\",\",order.shippingAddress.city,\",\",order.shippingAddress.postalCode,\",\",order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(Message,{children:[\"Delivered on \",order.deliveredAt,\" \"]}):/*#__PURE__*/_jsx(Message,{children:\"Not Delivered\"})]}),/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method:\"}),order.paymentMethod]}),order.isPaid?/*#__PURE__*/_jsxs(Message,{children:[\"Paid on \",order.paidAt,\" \"]}):/*#__PURE__*/_jsx(Message,{children:\"Not Paid\"})]}),/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Items\"}),order.orderItems.length===0?/*#__PURE__*/_jsx(Message,{children:\" Your order is empty\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"list-group list-group-flush\",children:order===null||order===void 0?void 0:order.orderItems.map(function(el,index){return/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-1\",children:/*#__PURE__*/_jsx(Image,{src:el.image,alt:el.name,className:\"img-fluid rounded\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(el.name),children:el.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-4\",children:[el.qty,\" x TND \",el.price,\" = TND \",el.qty*el.price]})]})});})}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method:\"}),order.paymentMethod]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"list-group list-group-flush\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Items\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"TND\",order.itemsPrice]})]})}),/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"TND\",order.shippingPrice]})]})}),/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Tax\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"TND\",order.taxPrice]})]})}),/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"TND\",order.totalPrice]})]})}),!order.isPaid&&/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item\",children:[loadingPay&&/*#__PURE__*/_jsx(Loader,{}),sdkReady?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHandler})]}),loadingDeliver&&/*#__PURE__*/_jsx(Loader,{}),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsx(Button,{type:\"button\",className:\"btn btn-block\",onClick:deliverHandler,children:\"Mark As delivered\"})})]})})})]})]});};export default OrderScreen;","map":{"version":3,"sources":["/home/youssef/Documents/workSpace/mern_e_commerce/frontend/src/screens/OrderScreen.js"],"names":["React","useState","useEffect","axios","PayPalButton","A","Image","Button","useDispatch","useSelector","Loader","Message","deliverOrder","getOrderDetails","payOrder","Link","OrderScreen","match","history","orderId","params","id","sdkReady","setSdkReady","dispatch","orderDetails","state","order","loading","error","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","userLogin","userInfo","addDecimal","num","Math","round","toFixed","itemsPrice","orderItems","reduce","acc","item","price","qty","push","addPaypalScript","get","clientId","data","script","document","createElement","type","src","async","onload","body","appendChild","ORDER_PAY_RESET","ORDER_DELIVER_RESET","isPaid","window","paypal","successPaymentHandler","paymentResult","console","log","deliverHandler","_id","user","name","email","shippingAddress","address","city","postalCode","country","isDelivered","deliveredAt","paymentMethod","paidAt","length","map","el","index","image","shippingPrice","taxPrice","totalPrice","isAdmin"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { PayPalButton } from 'react-paypal-button-v2';\nimport * as A from '../store/constants/orderConstant';\nimport { Image, Button } from 'react-bootstrap';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Loader } from '../components/Loader';\nimport { Message } from '../components/Message';\n\nimport {\n  deliverOrder,\n  getOrderDetails,\n  payOrder,\n} from '../store/actions/orderActions';\nimport { Link } from 'react-router-dom';\n\nconst OrderScreen = ({ match, history }) => {\n  const orderId = match.params.id;\n\n  const [sdkReady, setSdkReady] = useState(false);\n\n  const dispatch = useDispatch();\n\n  const orderDetails = useSelector((state) => state.orderDetails);\n  const { order, loading, error } = orderDetails;\n\n  const orderPay = useSelector((state) => state.orderPay);\n  const { loading: loadingPay, success: successPay } = orderPay;\n\n  const orderDeliver = useSelector((state) => state.orderDeliver);\n  const { loading: loadingDeliver, success: successDeliver } = orderDeliver;\n\n  const userLogin = useSelector((state) => state.userLogin);\n  const { userInfo } = userLogin;\n\n  //Calculate prices\n  if (!loading) {\n    const addDecimal = (num) => {\n      return (Math.round(num * 100) / 100).toFixed(2);\n    };\n\n    order.itemsPrice = addDecimal(\n      order.orderItems.reduce((acc, item) => acc + item.price * item.qty, 0)\n    );\n  }\n\n  useEffect(() => {\n    if (!userInfo) {\n      history.push('./login');\n    }\n\n    const addPaypalScript = async () => {\n      const { data: clientId } = await axios.get('/api/config/paypal');\n      const script = document.createElement('script');\n      script.type = 'text/javascript';\n      script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`;\n\n      script.async = true;\n      script.onload = () => {\n        setSdkReady(true);\n      };\n      document.body.appendChild(script);\n    };\n\n    if (!order || successPay || successDeliver) {\n      dispatch({ type: A.ORDER_PAY_RESET });\n      dispatch({ type: A.ORDER_DELIVER_RESET });\n      dispatch(getOrderDetails(orderId));\n    } else if (!order.isPaid) {\n      if (!window.paypal) {\n        addPaypalScript();\n      } else {\n        setSdkReady(true);\n      }\n    }\n  }, [dispatch, orderId, successPay, order, successDeliver]);\n\n  const successPaymentHandler = (paymentResult) => {\n    console.log('paymentResult', paymentResult);\n    dispatch(payOrder(orderId, paymentResult));\n  };\n\n  const deliverHandler = () => {\n    dispatch(deliverOrder(order));\n  };\n  return loading ? (\n    <Loader />\n  ) : error ? (\n    <Message>{error}</Message>\n  ) : (\n    <>\n      <h1>Order {order._id} </h1>\n\n      <div className='row'>\n        <div className='col-8'>\n          <ul className='list-group list-group-flush'>\n            <li className='list-group-item'>\n              <h2>Shipping</h2>\n              <p>\n                {' '}\n                <strong>Name:</strong>\n                {order.user.name}\n              </p>\n              <p>\n                <strong>Email:</strong>\n                <Link to={`mailto:${order.user.email}`}>\n                  {order.user.email}{' '}\n                </Link>\n              </p>\n\n              <p>\n                <strong>Address:</strong>\n                {order.shippingAddress.address},{order.shippingAddress.city},\n                {order.shippingAddress.postalCode},\n                {order.shippingAddress.country}\n              </p>\n              {order.isDelivered ? (\n                <Message>Delivered on {order.deliveredAt} </Message>\n              ) : (\n                <Message>Not Delivered</Message>\n              )}\n            </li>\n\n            <li className='list-group-item'>\n              <h2>Payment Method</h2>\n              <p>\n                <strong>Method:</strong>\n                {order.paymentMethod}\n              </p>\n              {order.isPaid ? (\n                <Message>Paid on {order.paidAt} </Message>\n              ) : (\n                <Message>Not Paid</Message>\n              )}\n            </li>\n\n            <li className='list-group-item'>\n              <h2>Order Items</h2>\n              {order.orderItems.length === 0 ? (\n                <Message> Your order is empty</Message>\n              ) : (\n                <ul className='list-group list-group-flush'>\n                  {order?.orderItems.map((el, index) => (\n                    <li className='list-group-item'>\n                      <div className='row'>\n                        <div className='col-md-1'>\n                          <Image\n                            src={el.image}\n                            alt={el.name}\n                            className='img-fluid rounded'\n                          />\n                        </div>\n                        <div className='col'>\n                          <Link to={`/product/${el.name}`}>{el.name}</Link>\n                        </div>\n                        <div className='col-md-4'>\n                          {el.qty} x TND {el.price} = TND {el.qty * el.price}\n                        </div>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              )}\n              <p>\n                <strong>Method:</strong>\n                {order.paymentMethod}\n              </p>\n            </li>\n          </ul>\n        </div>\n        <div className='col-md-4'>\n          <div className='card'>\n            <ul className='list-group list-group-flush'>\n              <li className='list-group-item'>\n                <h2>Order Summary</h2>\n              </li>\n              <li className='list-group-item'>\n                <div className='row'>\n                  <div className='col'>Items</div>\n                  <div className='col'>TND{order.itemsPrice}</div>\n                </div>\n              </li>\n\n              <li className='list-group-item'>\n                <div className='row'>\n                  <div className='col'>Shipping</div>\n                  <div className='col'>TND{order.shippingPrice}</div>\n                </div>\n              </li>\n              <li className='list-group-item'>\n                <div className='row'>\n                  <div className='col'>Tax</div>\n                  <div className='col'>TND{order.taxPrice}</div>\n                </div>\n              </li>\n              <li className='list-group-item'>\n                <div className='row'>\n                  <div className='col'>Total</div>\n                  <div className='col'>TND{order.totalPrice}</div>\n                </div>\n              </li>\n              {!order.isPaid && (\n                <li className='list-group-item'>\n                  {loadingPay && <Loader />}\n                  {sdkReady ? (\n                    <Loader />\n                  ) : (\n                    <PayPalButton\n                      amount={order.totalPrice}\n                      onSuccess={successPaymentHandler}\n                    />\n                  )}\n                </li>\n              )}\n\n              {loadingDeliver && <Loader />}\n              {userInfo &&\n                userInfo.isAdmin &&\n                order.isPaid &&\n                !order.isDelivered && (\n                  <li className='list-group-item'>\n                    <Button\n                      type='button'\n                      className='btn btn-block'\n                      onClick={deliverHandler}\n                    >\n                      Mark As delivered\n                    </Button>\n                  </li>\n                )}\n            </ul>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n};\nexport default OrderScreen;\n"]},"metadata":{},"sourceType":"module"}